<!DOCTYPE html>
<html
  xmlns:th="http://www.thymeleaf.org"
  xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
  layout:decorate="~{layouts/default-layout}">

<head>
<th:block layout:fragment="css">
	<link rel="stylesheet" href="/css/join.css">
</th:block>

<th:block layout:fragment="script">
	  <!-- 관심사 값이 없어도 무조건 array로 가게 -->
      <script type="text/javascript" th:inline="javascript">
      $(document).ready(function() {

    	  $("#btn-regist").click(function(e){

    		  let length = $("input:checkbox[name='interest']:checked").length;

    		  if (length > 0) {
    			   registMember(e);
    		  } else {
    			  alert("관심사는 한 개 이상 선택해주세요.");
    		  }
    	  });
      });

      /* 아이디 중복 체크 */
      function checkDuplicateId() {
    	   const userId = $("#userId").val();
    	   if (userId) {
    	      $.ajax({
    	         type: "GET",
    	         url: "/members/checkDuplicateId/" + userId
    	      })
    	      .done(function(result) {
    	         if (result === true) {
    	            alert("중복된 아이디입니다. 다른 아이디를 입력해주세요.");
    	         } else {
    	            alert("사용 가능한 아이디입니다.");
    	         }
    	      })
    	      .fail(function(data, textStatus, errorThrown) {
    	         console.log(data);
    	         alert("에러");
    	      });
    	   } else {
    	      alert("아이디를 입력해주세요.");
    	   }
    	}


      <!-- 등록, 회원 가입을 ajax로 호출-->
      /* 이동하지 않고 처리하기 위해. 성공했을 때만 메인으로 */
      function registMember(e){
		  e.preventDefault();

         $.ajax({
               type: "post",
               url: "/members/regist",
               data: $("#inputForm").serialize(),
			   success: (jsonResult) => {

				   console.log(jsonResult);
				   console.log("aaaaaaaaaaaaaaaaa");
				   if(jsonResult.result == "success"){
					   alert("가입이 완료되었습니다.");
					   location.href="/login";
				   }
				   else{
					   if(jsonResult.errors){
						   if(jsonResult.errors.includes("아이디를 반드시 입력해야 합니다.")) {
							   $("#idMessage").show();
						   } else if(jsonResult.errors.includes("비밀번호를 입력해주세요.")) {
							   $("#pwMessage").show();
						   } else if(jsonResult.errors.includes("비밀번호는 8~16자리수여야 합니다. 영문 대소문자, 숫자, 특수문자를 1개 이상 포함해야 합니다.")) {
							   $("#pwLengthMessage").show();
						   } else if(jsonResult.errors.includes("비밀번호를 재입력해주세요.")) {
							   $("#RePwMessage")
						   } else if(jsonResult.errors.includes("이름을 입력해주세요.")) {
							   $("#nameMessage").show();
						   } else if(jsonResult.errors.includes("휴대폰 번호를 입력해주세요.")) {
							   $("#phoneMessage").show();
						   } else if(jsonResult.errors.includes("이메일 주소를 입력해주세요.")) {
							   $("#emailMessage").show();
						   } else if(jsonResult.errors.includes("올바른 이메일 주소를 입력해주세요.")){
							   $("#emailFormMessage").show();
						   }
					   }

				   }
			   },
			 error:  (data, textStatus, errorThrown) => {
				 console.log(data);
				 if(data.responseJSON && data.responseJSON.errors) {
					 alert(data.responseJSON.errors);
				 } else {
					 alert("에러가 발생했습니다. 다시 시도해주세요.")
				 }

			 }
           });
      };


      </script>
</th:block>

</head>

<body>
 <th:block layout:fragment="content">
	<div class="join-container">

	<h2 id="join-join">회원가입</h2>

	<div class="join-line">
	<span class="join-line-text"></span>
	<h4 class="join-type">소셜 회원가입</h4>
	<span class="join-line-text"></span>
	</div>
	<div class="join-social-link">
	   <a th:href="@{/oauth2/authorization/kakao}">
       	<img src="https://d1nuzc1w51n1es.cloudfront.net/7edcff9c01ccc20d1ef6.png" alt="카카오 아이콘">
       </a>
       <a th:href="@{/oauth2/authorization/naver}">
       	<img src="https://image.rocketpunch.com/company/5466/naver_logo.png?s=400x400&t=inside" alt="네이버 아이콘">
       </a>
       <a th:href="@{/oauth2/authorization/google}">
       	<img src="https://d1nuzc1w51n1es.cloudfront.net/d99d8628713bb69bd142.png" alt="구글 아이콘">
       </a>
	</div>

	<div class="join-line">
	<span class="join-line-text"></span>
	<h4 class="join-type">일반 회원가입</h4>
	<span class="join-line-text"></span>
	</div>
	<form id="inputForm">
	    <table id="join-table">
	      <tr>
	        <td><label for="userId">아이디</label></td>
	        <td>
	           <input type="text" name="userId" id="userId" class="form-control-id" placeholder="아이디를 입력하세요">
			   <input type="button" id="btn-Id-duplication" value="중복확인" onclick="checkDuplicateId()">
			   <p id="idMessage" style="display:none;">아이디를 입력해주세요.</p>
	        </td>
	      </tr>
	      <tr>
	        <td><label for="password">비밀번호</label></td>
	        <td colspan="2">
	          <input type="text" name="password" id="password" class="form-control" placeholder="비밀번호를 입력하세요">
	          <p id="pwDefaultMessage">8~16자리수. 영문 대소문자, 숫자, 특수문자를 1개 이상 포함.</p>
	          <p id="pwMessage" style="display:none;">비밀번호를 입력해주세요.</p>
	          <p id="pwLengthMessage" style="display:none;">비밀번호 형식을 확인해주세요.</p>
	        </td>
	      </tr>
	      <tr>
	        <td><label for="RePassword">비밀번호 재확인</label></td>
	        <td colspan="2">
	          <input type="text" name="RePassword" id="RePassword" class="form-control" placeholder="비밀번호를 다시 입력하세요">
	        </td>
	      </tr>
	      <tr>
	        <td><label for="name">이름</label></td>
	        <td colspan="2">
	          <input type="text" name="name" id="name" class="form-control" placeholder="이름을 입력하세요">
	          <p id="nameMessage" style="display:none;">이름을 입력해주세요.</p>
	        </td>
	      </tr>
	      <tr>
	        <td><label>성별</label></td>
	        <td colspan="2">
	          <input type="radio" name="gender" id="female" value="W" checked="checked">
	          <label class="form-control-select" for="female">여자</label>
	          <input type="radio" name="gender" id="male" value="M">
	          <label class="form-control-select" for="male">남자</label>
	        </td>
	      </tr>
	      <tr>
	        <td><label for="phone">휴대전화</label></td>
	        <td colspan="2">
	          <input type="text" name="phone" id="phone" class="form-control" placeholder="전화번호를 입력하세요">
	          <p id="phoneMessage" style="display:none;">전화번호를 입력해주세요.</p>
	        </td>
	      </tr>
	      <tr>
	        <td><label for="mailId">이메일</label></td>
	        <td colspan="2">
	          <input type="text" name="email" id="mailId" class="form-control" placeholder="이메일을 입력하세요">
	          <p id="emailMessage" style="display:none;">이메일을 입력해주세요.</p>
	          <p id="emailFormMessage" style="display:none;">올바른 이메일을 입력해주세요.</p>
	        </td>
	      </tr>
	      <tr>
	        <td><label>관심분야</label></td>
	        <td colspan="2">
	          <input type="checkbox" id="interest_1" name="interest" value="백엔드">
	          <label class="form-control-select" for="interest_1">백엔드</label>
	          <input type="checkbox" id="interest_2" name="interest" value="프론트엔드">
	          <label class="form-control-select" for="interest_2">프론트엔드</label>
	          <input type="checkbox" id="interest_3" name="interest" value="모바일">
	          <label class="form-control-select" for="interest_3">모바일</label>
	          <input type="checkbox" id="interest_4" name="interest" value="기타">
	          <label class="form-control-select" for="interest_4">기타</label>
	        </td>
	      </tr>
	    </table>
		<div style="text-align: center;">
			<button type="submit" id="btn-regist">가입하기</button>
		</div>
	</form>
	</div>
</th:block>
</body>
</html>
