<!DOCTYPE html>
<html
  xmlns:th="http://www.thymeleaf.org"
  xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
  layout:decorate="~{layouts/default-layout}">
  
 <th:block layout:fragment="content">  

	<div class="container">
	
	<script th:src="@{/js/common.js}"></script>
	
	<h1>회원가입</h1>
	 
	 <form id="inputForm">
	  	 <div class="form-group">
			 <label for="userId">아이디</label>
			 <input type="text" name="userId" class="form-control"
			placeholder="아이디를 입력하세요">
			 <input type="button" class='btn-duplication'  value="ID중복확인" onclick="">
		 </div>
		 <div class="form-group">
			 <label for="password">비밀번호</label>
			 <input type="text" name="password" class="form-control"
			placeholder="비밀번호를 입력하세요">
		 </div>
		 <div class="form-group">
			 <label for="password">비밀번호 재확인</label>
			 <input type="text" name="passwordCk" class="form-control"
			placeholder="비밀번호를 다시 입력하세요">
		 </div>
		 <div class="form-group">
			 <label for="name">이름</label>
			 <input type="text" name="name" class="form-control"
			placeholder="이름을 입력하세요">
		 </div>
		 <div class="form-group">
			 <label for="gender">성별</label>
			 <input type="radio" name="gender" value="W" checked="checked">
			 <label for="female">여자</label>
			 <input type="radio" name="gender" value="M">
			 <label for="male">남자</label><br>
		 </div>
		 <div class="form-group">
			 <label for="phone">휴대전화</label>
			 <input type="text" name="phone" class="form-control"
			placeholder="전화번호를 입력하세요">
		 </div>
		 <div class="form-group">
		 	 <label for="email" class="email-label">이메일</label>
		     <input type="text" name="email" class="form-control" placeholder="이메일을 입력하세요">
		 </div>
		 <div class="form-group">
			 <label for="interest">관심분야</label>
			 <input type="checkbox" id="interest_1" name="interest" value="백엔드">
			 <label for="interest_1">백엔드</label>
			 <input type="checkbox" id="interest_2" name="interest" value="프론트엔드">
			 <label for="interest_2">프론트엔드</label>
			 <input type="checkbox" id="interest_3" name="interest" value="모바일">
			 <label for="interest_3">모바일</label>
			 <input type="checkbox" id="interest_4" name="interest" value="기타">
			 <label for="interest_4">기타</label><br>
		 </div>
		 <button type="button" class="btn btn-primary" id="btn-regist">가입하기</button>
	 </form>
	</div>
</th:block>

<th:block layout:fragment="script">
	  <!-- 관심사 값이 없어도 무조건 array로 가게 -->
      <script type="text/javascript" th:inline="javascript">
      $(document).ready(function() {
    	  
    	  $("#btn-regist").click(function(){
    		  
    		  var length = $("input:checkbox[name='interest']:checked").length;
    		  
    		  if (length > 0) {
    			   registMember();
    		  } else {
    			  alert("관심사는 한 개 이상 선택해주세요.");
    		  }
    	  });
      });
      

      <!-- 등록, 회원 가입을 ajax로 호출-->
      /* 이동하지 않고 처리하기 위해. 성공했을 때만 메인으로 */
      function registMember(){
         
    	 /*inputForm 자체를 Object로 만든 거*/
         var params = $("#inputForm").serializeObject();
         
    	 /*체크된 게 있으면 input에 들어온 값이 들어오고 아니면 빈 배열이 리턴*/
         var arr = new Array();
         
  
         
         $("input:checkbox[name='interest']:checked").each(function(){
			arr.push($(this).val());
        });
         params.interest = arr;
         console.log(params);
         
         $.ajax({
               type: "POST",
               url: /*[[@{/members/regist}]]*/'',
               dataType:"json",
               data: JSON.stringify(params),
               contentType: 'application/json'
           })
           .done(function (jsonResult) {
              console.log(jsonResult);
            if(jsonResult.result == "success"){
            	alert("가입이 완료되었습니다.");
            	location.href="/";
            }
            else{
               alert("가입이 실패하였습니다.");
            }
           })
           .fail(function(data, textStatus, errorThrown){
        	   console.log(data);
              alert("에러");
           });      
      }
      </script>
      </th:block>
</html>
